{"version":3,"file":"Control.Geocoder.js","sources":["../src/geocoders/api.ts","../src/util.ts","../src/geocoders/arcgis.ts","../src/geocoders/bing.ts","../src/geocoders/google.ts","../src/geocoders/here.ts","../src/geocoders/latlng.ts","../src/geocoders/mapbox.ts","../src/geocoders/mapquest.ts","../src/geocoders/neutrino.ts","../src/geocoders/nominatim.ts","../src/geocoders/open-location-code.ts","../src/geocoders/opencage.ts","../src/geocoders/pelias.ts","../src/geocoders/photon.ts","../src/geocoders/what3words.ts","../src/control.ts","../src/index.ts"],"sourcesContent":["import * as L from 'leaflet';\r\n\r\n/**\r\n * An object that represents a result from a geocoding query\r\n */\r\nexport interface GeocodingResult {\r\n  /**\r\n   * Name of found location\r\n   */\r\n  name: string;\r\n  /**\r\n   * The bounds of the location\r\n   */\r\n  bbox: L.LatLngBounds;\r\n  /**\r\n   * The center coordinate of the location\r\n   */\r\n  center: L.LatLng;\r\n  /**\r\n   * URL for icon representing result; optional\r\n   */\r\n  icon?: string;\r\n  /**\r\n   * HTML formatted representation of the name\r\n   */\r\n  html?: string;\r\n  /**\r\n   * Additional properties returned by the geocoder\r\n   */\r\n  properties?: any;\r\n}\r\n\r\n/**\r\n * A callback function used in {@link IGeocoder.geocode} and {@link IGeocoder.suggest} and {@link IGeocoder.reverse}\r\n */\r\nexport type GeocodingCallback = (result: GeocodingResult[]) => void;\r\n\r\n/**\r\n * An interface implemented to respond to geocoding queries\r\n */\r\nexport interface IGeocoder {\r\n  /**\r\n   * Performs a geocoding query and returns the results to the callback in the provided context\r\n   * @param query the query\r\n   * @param cb the callback function\r\n   * @param context the `this` context in the callback\r\n   */\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void;\r\n  /**\r\n   * Performs a geocoding query suggestion (this happens while typing) and returns the results to the callback in the provided context\r\n   * @param query the query\r\n   * @param cb the callback function\r\n   * @param context the `this` context in the callback\r\n   */\r\n  suggest?(query: string, cb: GeocodingCallback, context?: any): void;\r\n  /**\r\n   * Performs a reverse geocoding query and returns the results to the callback in the provided context\r\n   * @param location the coordinate to reverse geocode\r\n   * @param scale the map scale possibly used for reverse geocoding\r\n   * @param cb the callback function\r\n   * @param context the `this` context in the callback\r\n   */\r\n  reverse?(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void;\r\n}\r\n\r\nexport interface GeocoderOptions {\r\n  /**\r\n   * URL of the service\r\n   */\r\n  serviceUrl: string;\r\n  /**\r\n   * Additional URL parameters (strings) that will be added to geocoding requests\r\n   */\r\n  geocodingQueryParams?: Record<string, unknown>;\r\n  /**\r\n   * Additional URL parameters (strings) that will be added to reverse geocoding requests\r\n   */\r\n  reverseQueryParams?: Record<string, unknown>;\r\n  /**\r\n   * API key to use this service\r\n   */\r\n  apiKey?: string;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function geocodingParams(\r\n  options: GeocoderOptions,\r\n  params: Record<string, unknown>\r\n): Record<string, unknown> {\r\n  return L.Util.extend(params, options.geocodingQueryParams);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function reverseParams(\r\n  options: GeocoderOptions,\r\n  params: Record<string, unknown>\r\n): Record<string, unknown> {\r\n  return L.Util.extend(params, options.reverseQueryParams);\r\n}\r\n","import * as L from 'leaflet';\r\n/**\r\n * @internal\r\n */\r\nlet lastCallbackId = 0;\r\n\r\n// Adapted from handlebars.js\r\n// https://github.com/wycats/handlebars.js/\r\n/**\r\n * @internal\r\n */\r\nconst badChars = /[&<>\"'`]/g;\r\n/**\r\n * @internal\r\n */\r\nconst possible = /[&<>\"'`]/;\r\n/**\r\n * @internal\r\n */\r\nconst escape: Record<string, string> = {\r\n  '&': '&amp;',\r\n  '<': '&lt;',\r\n  '>': '&gt;',\r\n  '\"': '&quot;',\r\n  \"'\": '&#x27;',\r\n  '`': '&#x60;'\r\n};\r\n\r\n/**\r\n * @internal\r\n */\r\nfunction escapeChar(chr: string) {\r\n  return escape[chr];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function htmlEscape(string?: string): string {\r\n  if (string == null) {\r\n    return '';\r\n  } else if (!string) {\r\n    return string + '';\r\n  }\r\n\r\n  // Force a string conversion as this will be done by the append regardless and\r\n  // the regex test will do this transparently behind the scenes, causing issues if\r\n  // an object's to string has escaped characters in it.\r\n  string = '' + string;\r\n\r\n  if (!possible.test(string)) {\r\n    return string;\r\n  }\r\n  return string.replace(badChars, escapeChar);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function jsonp(\r\n  url: string,\r\n  params: Record<string, any>,\r\n  callback: (message: any) => void,\r\n  context: any,\r\n  jsonpParam?: string\r\n) {\r\n  const callbackId = '_l_geocoder_' + lastCallbackId++;\r\n  params[jsonpParam || 'callback'] = callbackId;\r\n  (window as any)[callbackId] = L.Util.bind(callback, context);\r\n  const script = document.createElement('script');\r\n  script.type = 'text/javascript';\r\n  script.src = url + getParamString(params);\r\n  script.id = callbackId;\r\n  document.getElementsByTagName('head')[0].appendChild(script);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function getJSON(\r\n  url: string,\r\n  params: Record<string, unknown>,\r\n  callback: (message: any) => void\r\n): void {\r\n  const xmlHttp = new XMLHttpRequest();\r\n  xmlHttp.onreadystatechange = function() {\r\n    if (xmlHttp.readyState !== 4) {\r\n      return;\r\n    }\r\n    let message;\r\n    if (xmlHttp.status !== 200 && xmlHttp.status !== 304) {\r\n      message = '';\r\n    } else if (typeof xmlHttp.response === 'string') {\r\n      // IE doesn't parse JSON responses even with responseType: 'json'.\r\n      try {\r\n        message = JSON.parse(xmlHttp.response);\r\n      } catch (e) {\r\n        // Not a JSON response\r\n        message = xmlHttp.response;\r\n      }\r\n    } else {\r\n      message = xmlHttp.response;\r\n    }\r\n    callback(message);\r\n  };\r\n  xmlHttp.open('GET', url + getParamString(params), true);\r\n  xmlHttp.responseType = 'json';\r\n  xmlHttp.setRequestHeader('Accept', 'application/json');\r\n  xmlHttp.send(null);\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function template(str: string, data: Record<string, any>): string {\r\n  return str.replace(/\\{ *([\\w_]+) *\\}/g, (str, key) => {\r\n    let value = data[key];\r\n    if (value === undefined) {\r\n      value = '';\r\n    } else if (typeof value === 'function') {\r\n      value = value(data);\r\n    }\r\n    return htmlEscape(value);\r\n  });\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function getParamString(\r\n  obj: Record<string, unknown | unknown[]>,\r\n  existingUrl?: string,\r\n  uppercase?: boolean\r\n): string {\r\n  const params = [];\r\n  for (const i in obj) {\r\n    const key = encodeURIComponent(uppercase ? i.toUpperCase() : i);\r\n    const value = obj[i];\r\n    if (!Array.isArray(value)) {\r\n      params.push(key + '=' + encodeURIComponent(String(value)));\r\n    } else {\r\n      for (let j = 0; j < value.length; j++) {\r\n        params.push(key + '=' + encodeURIComponent(value[j]));\r\n      }\r\n    }\r\n  }\r\n  return (!existingUrl || existingUrl.indexOf('?') === -1 ? '?' : '&') + params.join('&');\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface ArcGisOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [ArcGIS geocoder](https://developers.arcgis.com/features/geocoding/)\r\n */\r\nexport class ArcGis implements IGeocoder {\r\n  options: ArcGisOptions = {\r\n    serviceUrl: 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer',\r\n    apiKey: ''\r\n  };\r\n\r\n  constructor(options?: Partial<ArcGisOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      token: this.options.apiKey,\r\n      SingleLine: query,\r\n      outFields: 'Addr_Type',\r\n      forStorage: false,\r\n      maxLocations: 10,\r\n      f: 'json'\r\n    });\r\n\r\n    getJSON(this.options.serviceUrl + '/findAddressCandidates', params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.candidates && data.candidates.length) {\r\n        for (let i = 0; i <= data.candidates.length - 1; i++) {\r\n          const loc = data.candidates[i];\r\n          const latLng = L.latLng(loc.location.y, loc.location.x);\r\n          const latLngBounds = L.latLngBounds(\r\n            L.latLng(loc.extent.ymax, loc.extent.xmax),\r\n            L.latLng(loc.extent.ymin, loc.extent.xmin)\r\n          );\r\n          results[i] = {\r\n            name: loc.address,\r\n            bbox: latLngBounds,\r\n            center: latLng\r\n          };\r\n        }\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      location: location.lng + ',' + location.lat,\r\n      distance: 100,\r\n      f: 'json'\r\n    });\r\n    getJSON(this.options.serviceUrl + '/reverseGeocode', params, data => {\r\n      const result: GeocodingResult[] = [];\r\n      if (data && !data.error) {\r\n        const center = L.latLng(data.location.y, data.location.x);\r\n        const bbox = L.latLngBounds(center, center);\r\n        result.push({\r\n          name: data.address.Match_addr,\r\n          center: center,\r\n          bbox: bbox\r\n        });\r\n      }\r\n\r\n      cb.call(context, result);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link ArcGis}\r\n * @param options the options\r\n */\r\nexport function arcgis(options?: Partial<ArcGisOptions>) {\r\n  return new ArcGis(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { jsonp } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface BingOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [Bing Locations API](https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/)\r\n */\r\nexport class Bing implements IGeocoder {\r\n  options: BingOptions = {\r\n    serviceUrl: 'https://dev.virtualearth.net/REST/v1/Locations'\r\n  };\r\n\r\n  constructor(options?: Partial<BingOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      query: query,\r\n      key: this.options.apiKey\r\n    });\r\n    jsonp(\r\n      this.options.apiKey,\r\n      params,\r\n      data => {\r\n        const results: GeocodingResult[] = [];\r\n        if (data.resourceSets.length > 0) {\r\n          for (let i = data.resourceSets[0].resources.length - 1; i >= 0; i--) {\r\n            const resource = data.resourceSets[0].resources[i],\r\n              bbox = resource.bbox;\r\n            results[i] = {\r\n              name: resource.name,\r\n              bbox: L.latLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\r\n              center: L.latLng(resource.point.coordinates)\r\n            };\r\n          }\r\n        }\r\n        cb.call(context, results);\r\n      },\r\n      this,\r\n      'jsonp'\r\n    );\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      key: this.options.apiKey\r\n    });\r\n    jsonp(\r\n      this.options.serviceUrl + location.lat + ',' + location.lng,\r\n      params,\r\n      data => {\r\n        const results: GeocodingResult[] = [];\r\n        for (let i = data.resourceSets[0].resources.length - 1; i >= 0; i--) {\r\n          const resource = data.resourceSets[0].resources[i],\r\n            bbox = resource.bbox;\r\n          results[i] = {\r\n            name: resource.name,\r\n            bbox: L.latLngBounds([bbox[0], bbox[1]], [bbox[2], bbox[3]]),\r\n            center: L.latLng(resource.point.coordinates)\r\n          };\r\n        }\r\n        cb.call(context, results);\r\n      },\r\n      this,\r\n      'jsonp'\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Bing}\r\n * @param options the options\r\n */\r\nexport function bing(options?: Partial<BingOptions>) {\r\n  return new Bing(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\n/**\r\n * Implementation of the [Google Geocoding API](https://developers.google.com/maps/documentation/geocoding/)\r\n */\r\nexport interface GoogleOptions extends GeocoderOptions {}\r\n\r\nexport class Google implements IGeocoder {\r\n  options: GoogleOptions = {\r\n    serviceUrl: 'https://maps.googleapis.com/maps/api/geocode/json'\r\n  };\r\n\r\n  constructor(options?: Partial<GoogleOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      key: this.options.apiKey,\r\n      address: query\r\n    });\r\n    getJSON(this.options.serviceUrl, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.results && data.results.length) {\r\n        for (let i = 0; i <= data.results.length - 1; i++) {\r\n          const loc = data.results[i];\r\n          const latLng = L.latLng(loc.geometry.location);\r\n          const latLngBounds = L.latLngBounds(\r\n            L.latLng(loc.geometry.viewport.northeast),\r\n            L.latLng(loc.geometry.viewport.southwest)\r\n          );\r\n          results[i] = {\r\n            name: loc.formatted_address,\r\n            bbox: latLngBounds,\r\n            center: latLng,\r\n            properties: loc.address_components\r\n          };\r\n        }\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      key: this.options.apiKey,\r\n      latlng: location.lat + ',' + location.lng\r\n    });\r\n    getJSON(this.options.serviceUrl, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.results && data.results.length) {\r\n        for (let i = 0; i <= data.results.length - 1; i++) {\r\n          const loc = data.results[i];\r\n          const center = L.latLng(loc.geometry.location);\r\n          const bbox = L.latLngBounds(\r\n            L.latLng(loc.geometry.viewport.northeast),\r\n            L.latLng(loc.geometry.viewport.southwest)\r\n          );\r\n          results[i] = {\r\n            name: loc.formatted_address,\r\n            bbox: bbox,\r\n            center: center,\r\n            properties: loc.address_components\r\n          };\r\n        }\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Google}\r\n * @param options the options\r\n */\r\nexport function google(options?: Partial<GoogleOptions>) {\r\n  return new Google(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface HereOptions extends GeocoderOptions {\r\n  /**\r\n   * Use `apiKey` and the new `HEREv2` geocoder\r\n   * @deprecated\r\n   */\r\n  app_id: string;\r\n  /**\r\n   * Use `apiKey` and the new `HEREv2` geocoder\r\n   * @deprecated\r\n   */\r\n  app_code: string;\r\n  reverseGeocodeProxRadius?: any;\r\n  apiKey: string;\r\n}\r\n\r\n/**\r\n * Implementation of the [HERE Geocoder API](https://developer.here.com/documentation/geocoder/topics/introduction.html)\r\n */\r\nexport class HERE implements IGeocoder {\r\n  options: HereOptions = {\r\n    serviceUrl: 'https://geocoder.api.here.com/6.2/',\r\n    app_id: '',\r\n    app_code: '',\r\n    apiKey: ''\r\n  };\r\n\r\n  constructor(options?: Partial<HereOptions>) {\r\n    L.Util.setOptions(this, options);\r\n    if (options.apiKey) throw Error('apiKey is not supported, use app_id/app_code instead!');\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      searchtext: query,\r\n      gen: 9,\r\n      app_id: this.options.app_id,\r\n      app_code: this.options.app_code,\r\n      jsonattributes: 1\r\n    });\r\n    this.getJSON(this.options.serviceUrl + 'geocode.json', params, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    let prox = location.lat + ',' + location.lng;\r\n    if (this.options.reverseGeocodeProxRadius) {\r\n      prox += ',' + this.options.reverseGeocodeProxRadius;\r\n    }\r\n    const params = reverseParams(this.options, {\r\n      prox,\r\n      mode: 'retrieveAddresses',\r\n      app_id: this.options.app_id,\r\n      app_code: this.options.app_code,\r\n      gen: 9,\r\n      jsonattributes: 1\r\n    });\r\n    this.getJSON(this.options.serviceUrl + 'reversegeocode.json', params, cb, context);\r\n  }\r\n\r\n  getJSON(url: string, params: any, cb: GeocodingCallback, context?: any) {\r\n    getJSON(url, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.response.view && data.response.view.length) {\r\n        for (let i = 0; i <= data.response.view[0].result.length - 1; i++) {\r\n          const loc = data.response.view[0].result[i].location;\r\n          const center = L.latLng(loc.displayPosition.latitude, loc.displayPosition.longitude);\r\n          const bbox = L.latLngBounds(\r\n            L.latLng(loc.mapView.topLeft.latitude, loc.mapView.topLeft.longitude),\r\n            L.latLng(loc.mapView.bottomRight.latitude, loc.mapView.bottomRight.longitude)\r\n          );\r\n          results[i] = {\r\n            name: loc.address.label,\r\n            properties: loc.address,\r\n            bbox: bbox,\r\n            center: center\r\n          };\r\n        }\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Implementation of the new [HERE Geocoder API](https://developer.here.com/documentation/geocoding-search-api/api-reference-swagger.html)\r\n */\r\nexport class HEREv2 implements IGeocoder {\r\n  options: HereOptions = {\r\n    serviceUrl: 'https://geocode.search.hereapi.com/v1',\r\n    apiKey: '',\r\n    app_id: '',\r\n    app_code: ''\r\n  };\r\n\r\n  constructor(options?: Partial<HereOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      q: query,\r\n      apiKey: this.options.apiKey\r\n    });\r\n\r\n    if (!params.at && !params.in) {\r\n      throw Error(\r\n        'at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.'\r\n      );\r\n    }\r\n\r\n    this.getJSON(this.options.serviceUrl + '/discover', params, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      at: location.lat + ',' + location.lng,\r\n      limit: this.options.reverseGeocodeProxRadius,\r\n      apiKey: this.options.apiKey\r\n    });\r\n    this.getJSON(this.options.serviceUrl + '/revgeocode', params, cb, context);\r\n  }\r\n\r\n  getJSON(url: string, params: any, cb: GeocodingCallback, context?: any) {\r\n    getJSON(url, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n\r\n      if (data.items && data.items.length) {\r\n        for (let i = 0; i <= data.items.length - 1; i++) {\r\n          const item = data.items[i];\r\n          const latLng = L.latLng(item.position.lat, item.position.lng);\r\n          let bbox: L.LatLngBounds;\r\n          if (item.mapView) {\r\n            bbox = L.latLngBounds(\r\n              L.latLng(item.mapView.south, item.mapView.west),\r\n              L.latLng(item.mapView.north, item.mapView.east)\r\n            );\r\n          } else {\r\n            // Using only position when not provided\r\n            bbox = L.latLngBounds(\r\n              L.latLng(item.position.lat, item.position.lng),\r\n              L.latLng(item.position.lat, item.position.lng)\r\n            );\r\n          }\r\n          results[i] = {\r\n            name: item.address.label,\r\n            properties: item.address,\r\n            bbox: bbox,\r\n            center: latLng\r\n          };\r\n        }\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link HERE}\r\n * @param options the options\r\n */\r\nexport function here(options?: Partial<HereOptions>) {\r\n  if (options.apiKey) {\r\n    return new HEREv2(options);\r\n  } else {\r\n    return new HERE(options);\r\n  }\r\n}\r\n","import * as L from 'leaflet';\r\nimport { IGeocoder, GeocodingCallback, GeocodingResult } from './api';\r\n\r\nexport interface LatLngOptions {\r\n  /**\r\n   * The next geocoder to use for non-supported queries\r\n   */\r\n  next?: IGeocoder;\r\n  /**\r\n   * The size in meters used for passing to `LatLng.toBounds`\r\n   */\r\n  sizeInMeters: number;\r\n}\r\n\r\n/**\r\n * Parses basic latitude/longitude strings such as `'50.06773 14.37742'`, `'N50.06773 W14.37742'`, `'S 50° 04.064 E 014° 22.645'`, or `'S 50° 4′ 03.828″, W 14° 22′ 38.712″'`\r\n * @param query the latitude/longitude string to parse\r\n * @returns the parsed latitude/longitude\r\n */\r\nexport function parseLatLng(query: string): L.LatLng | undefined {\r\n  let match;\r\n  // regex from https://github.com/openstreetmap/openstreetmap-website/blob/master/app/controllers/geocoder_controller.rb\r\n  if ((match = query.match(/^([NS])\\s*(\\d{1,3}(?:\\.\\d*)?)\\W*([EW])\\s*(\\d{1,3}(?:\\.\\d*)?)$/))) {\r\n    // [NSEW] decimal degrees\r\n    return L.latLng(\r\n      (/N/i.test(match[1]) ? 1 : -1) * +match[2],\r\n      (/E/i.test(match[3]) ? 1 : -1) * +match[4]\r\n    );\r\n  } else if (\r\n    (match = query.match(/^(\\d{1,3}(?:\\.\\d*)?)\\s*([NS])\\W*(\\d{1,3}(?:\\.\\d*)?)\\s*([EW])$/))\r\n  ) {\r\n    // decimal degrees [NSEW]\r\n    return L.latLng(\r\n      (/N/i.test(match[2]) ? 1 : -1) * +match[1],\r\n      (/E/i.test(match[4]) ? 1 : -1) * +match[3]\r\n    );\r\n  } else if (\r\n    (match = query.match(\r\n      /^([NS])\\s*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\W*([EW])\\s*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?$/\r\n    ))\r\n  ) {\r\n    // [NSEW] degrees, decimal minutes\r\n    return L.latLng(\r\n      (/N/i.test(match[1]) ? 1 : -1) * (+match[2] + +match[3] / 60),\r\n      (/E/i.test(match[4]) ? 1 : -1) * (+match[5] + +match[6] / 60)\r\n    );\r\n  } else if (\r\n    (match = query.match(\r\n      /^(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\s*([NS])\\W*(\\d{1,3})°?\\s*(\\d{1,3}(?:\\.\\d*)?)?['′]?\\s*([EW])$/\r\n    ))\r\n  ) {\r\n    // degrees, decimal minutes [NSEW]\r\n    return L.latLng(\r\n      (/N/i.test(match[3]) ? 1 : -1) * (+match[1] + +match[2] / 60),\r\n      (/E/i.test(match[6]) ? 1 : -1) * (+match[4] + +match[5] / 60)\r\n    );\r\n  } else if (\r\n    (match = query.match(\r\n      /^([NS])\\s*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?\\W*([EW])\\s*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?$/\r\n    ))\r\n  ) {\r\n    // [NSEW] degrees, minutes, decimal seconds\r\n    return L.latLng(\r\n      (/N/i.test(match[1]) ? 1 : -1) * (+match[2] + +match[3] / 60 + +match[4] / 3600),\r\n      (/E/i.test(match[5]) ? 1 : -1) * (+match[6] + +match[7] / 60 + +match[8] / 3600)\r\n    );\r\n  } else if (\r\n    (match = query.match(\r\n      /^(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]\\s*([NS])\\W*(\\d{1,3})°?\\s*(\\d{1,2})['′]?\\s*(\\d{1,3}(?:\\.\\d*)?)?[\"″]?\\s*([EW])$/\r\n    ))\r\n  ) {\r\n    // degrees, minutes, decimal seconds [NSEW]\r\n    return L.latLng(\r\n      (/N/i.test(match[4]) ? 1 : -1) * (+match[1] + +match[2] / 60 + +match[3] / 3600),\r\n      (/E/i.test(match[8]) ? 1 : -1) * (+match[5] + +match[6] / 60 + +match[7] / 3600)\r\n    );\r\n  } else if ((match = query.match(/^\\s*([+-]?\\d+(?:\\.\\d*)?)\\s*[\\s,]\\s*([+-]?\\d+(?:\\.\\d*)?)\\s*$/))) {\r\n    return L.latLng(+match[1], +match[2]);\r\n  }\r\n}\r\n\r\n/**\r\n * Parses basic latitude/longitude strings such as `'50.06773 14.37742'`, `'N50.06773 W14.37742'`, `'S 50° 04.064 E 014° 22.645'`, or `'S 50° 4′ 03.828″, W 14° 22′ 38.712″'`\r\n */\r\nexport class LatLng implements IGeocoder {\r\n  options: LatLngOptions = {\r\n    next: undefined,\r\n    sizeInMeters: 10000\r\n  };\r\n\r\n  constructor(options?: Partial<LatLngOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any) {\r\n    const center = parseLatLng(query);\r\n    if (center) {\r\n      const results: GeocodingResult[] = [\r\n        {\r\n          name: query,\r\n          center: center,\r\n          bbox: center.toBounds(this.options.sizeInMeters)\r\n        }\r\n      ];\r\n      cb.call(context, results);\r\n    } else if (this.options.next) {\r\n      this.options.next.geocode(query, cb, context);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link LatLng}\r\n * @param options the options\r\n */\r\nexport function latLng(options?: Partial<LatLngOptions>) {\r\n  return new LatLng(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface MapboxOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [Mapbox Geocoding](https://www.mapbox.com/api-documentation/#geocoding)\r\n */\r\nexport class Mapbox implements IGeocoder {\r\n  options: MapboxOptions = {\r\n    serviceUrl: 'https://api.mapbox.com/geocoding/v5/mapbox.places/'\r\n  };\r\n\r\n  constructor(options?: Partial<MapboxOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  _getProperties(loc) {\r\n    const properties = {\r\n      text: loc.text,\r\n      address: loc.address\r\n    };\r\n\r\n    for (let j = 0; j < (loc.context || []).length; j++) {\r\n      const id = loc.context[j].id.split('.')[0];\r\n      properties[id] = loc.context[j].text;\r\n\r\n      // Get country code when available\r\n      if (loc.context[j].short_code) {\r\n        properties['countryShortCode'] = loc.context[j].short_code;\r\n      }\r\n    }\r\n    return properties;\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params: any = geocodingParams(this.options, {\r\n      access_token: this.options.apiKey\r\n    });\r\n    if (\r\n      params.proximity !== undefined &&\r\n      params.proximity.lat !== undefined &&\r\n      params.proximity.lng !== undefined\r\n    ) {\r\n      params.proximity = params.proximity.lng + ',' + params.proximity.lat;\r\n    }\r\n    getJSON(this.options.serviceUrl + encodeURIComponent(query) + '.json', params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.features && data.features.length) {\r\n        for (let i = 0; i <= data.features.length - 1; i++) {\r\n          const loc = data.features[i];\r\n          const center = L.latLng(loc.center.reverse());\r\n          let bbox: L.LatLngBounds;\r\n          if (loc.bbox) {\r\n            bbox = L.latLngBounds(\r\n              L.latLng(loc.bbox.slice(0, 2).reverse()),\r\n              L.latLng(loc.bbox.slice(2, 4).reverse())\r\n            );\r\n          } else {\r\n            bbox = L.latLngBounds(center, center);\r\n          }\r\n\r\n          results[i] = {\r\n            name: loc.place_name,\r\n            bbox: bbox,\r\n            center: center,\r\n            properties: this._getProperties(loc)\r\n          };\r\n        }\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const url = this.options.serviceUrl + location.lng + ',' + location.lat + '.json';\r\n    const param = reverseParams(this.options, {\r\n      access_token: this.options.apiKey\r\n    });\r\n    getJSON(url, param, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.features && data.features.length) {\r\n        for (let i = 0; i <= data.features.length - 1; i++) {\r\n          const loc = data.features[i];\r\n          const center = L.latLng(loc.center.reverse());\r\n          let bbox: L.LatLngBounds;\r\n          if (loc.bbox) {\r\n            bbox = L.latLngBounds(\r\n              L.latLng(loc.bbox.slice(0, 2).reverse()),\r\n              L.latLng(loc.bbox.slice(2, 4).reverse())\r\n            );\r\n          } else {\r\n            bbox = L.latLngBounds(center, center);\r\n          }\r\n          results[i] = {\r\n            name: loc.place_name,\r\n            bbox: bbox,\r\n            center: center,\r\n            properties: this._getProperties(loc)\r\n          };\r\n        }\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Mapbox}\r\n * @param options the options\r\n */\r\nexport function mapbox(options?: Partial<MapboxOptions>) {\r\n  return new Mapbox(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface MapQuestOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [MapQuest Geocoding API](http://developer.mapquest.com/web/products/dev-services/geocoding-ws)\r\n */\r\nexport class MapQuest implements IGeocoder {\r\n  options: MapQuestOptions = {\r\n    serviceUrl: 'https://www.mapquestapi.com/geocoding/v1'\r\n  };\r\n\r\n  constructor(options?: Partial<MapQuestOptions>) {\r\n    L.Util.setOptions(this, options);\r\n    // MapQuest seems to provide URI encoded API keys,\r\n    // so to avoid encoding them twice, we decode them here\r\n    this.options.apiKey = decodeURIComponent(this.options.apiKey);\r\n  }\r\n\r\n  _formatName(...parts: string[]) {\r\n    return parts.filter(s => !!s).join(', ');\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      key: this.options.apiKey,\r\n      location: query,\r\n      limit: 5,\r\n      outFormat: 'json'\r\n    });\r\n    getJSON(\r\n      this.options.serviceUrl + '/address',\r\n      params,\r\n      L.Util.bind(function(data) {\r\n        const results: GeocodingResult[] = [];\r\n        if (data.results && data.results[0].locations) {\r\n          for (let i = data.results[0].locations.length - 1; i >= 0; i--) {\r\n            const loc = data.results[0].locations[i];\r\n            const center = L.latLng(loc.latLng);\r\n            results[i] = {\r\n              name: this._formatName(loc.street, loc.adminArea4, loc.adminArea3, loc.adminArea1),\r\n              bbox: L.latLngBounds(center, center),\r\n              center: center\r\n            };\r\n          }\r\n        }\r\n\r\n        cb.call(context, results);\r\n      }, this)\r\n    );\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      key: this.options.apiKey,\r\n      location: location.lat + ',' + location.lng,\r\n      outputFormat: 'json'\r\n    });\r\n    getJSON(\r\n      this.options.serviceUrl + '/reverse',\r\n      params,\r\n      L.Util.bind(function(data) {\r\n        const results: GeocodingResult[] = [];\r\n        if (data.results && data.results[0].locations) {\r\n          for (let i = data.results[0].locations.length - 1; i >= 0; i--) {\r\n            const loc = data.results[0].locations[i];\r\n            const center = L.latLng(loc.latLng);\r\n            results[i] = {\r\n              name: this._formatName(loc.street, loc.adminArea4, loc.adminArea3, loc.adminArea1),\r\n              bbox: L.latLngBounds(center, center),\r\n              center: center\r\n            };\r\n          }\r\n        }\r\n\r\n        cb.call(context, results);\r\n      }, this)\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link MapQuest}\r\n * @param options the options\r\n */\r\nexport function mapQuest(options?: Partial<MapQuestOptions>) {\r\n  return new MapQuest(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface NeutrinoOptions extends GeocoderOptions {\r\n  userId: string;\r\n}\r\n\r\n/**\r\n * Implementation of the [Neutrino API](https://www.neutrinoapi.com/api/geocode-address/)\r\n */\r\nexport class Neutrino implements IGeocoder {\r\n  options: NeutrinoOptions = {\r\n    userId: undefined,\r\n    apiKey: undefined,\r\n    serviceUrl: 'https://neutrinoapi.com/'\r\n  };\r\n\r\n  constructor(options?: Partial<NeutrinoOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  // https://www.neutrinoapi.com/api/geocode-address/\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      apiKey: this.options.apiKey,\r\n      userId: this.options.userId,\r\n      //get three words and make a dot based string\r\n      address: query.split(/\\s+/).join('.')\r\n    });\r\n    getJSON(this.options.serviceUrl + 'geocode-address', params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.locations) {\r\n        data.geometry = data.locations[0];\r\n        const center = L.latLng(data.geometry['latitude'], data.geometry['longitude']);\r\n        const bbox = L.latLngBounds(center, center);\r\n        results[0] = {\r\n          name: data.geometry.address,\r\n          bbox: bbox,\r\n          center: center\r\n        };\r\n      }\r\n\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  // https://www.neutrinoapi.com/api/geocode-reverse/\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      apiKey: this.options.apiKey,\r\n      userId: this.options.userId,\r\n      latitude: location.lat,\r\n      longitude: location.lng\r\n    });\r\n    getJSON(this.options.serviceUrl + 'geocode-reverse', params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.status.status == 200 && data.found) {\r\n        const center = L.latLng(location.lat, location.lng);\r\n        const bbox = L.latLngBounds(center, center);\r\n        results[0] = {\r\n          name: data.address,\r\n          bbox: bbox,\r\n          center: center\r\n        };\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Neutrino}\r\n * @param options the options\r\n */\r\nexport function neutrino(options?: Partial<NeutrinoOptions>) {\r\n  return new Neutrino(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { template, getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface NominatimResult {\r\n  place_id: number;\r\n  licence: string;\r\n  osm_type: string;\r\n  osm_id: number;\r\n  boundingbox: string[];\r\n  lat: string;\r\n  lon: string;\r\n  display_name: string;\r\n  class: string;\r\n  type: string;\r\n  importance: number;\r\n  icon?: string;\r\n  address: NominatimAddress;\r\n}\r\n\r\nexport interface NominatimAddress {\r\n  building?: string;\r\n  city_district?: string;\r\n  city?: string;\r\n  country_code?: string;\r\n  country?: string;\r\n  county?: string;\r\n  hamlet?: string;\r\n  house_number?: string;\r\n  neighbourhood?: string;\r\n  postcode?: string;\r\n  road?: string;\r\n  state_district?: string;\r\n  state?: string;\r\n  suburb?: string;\r\n  village?: string;\r\n}\r\n\r\nexport interface NominatimOptions extends GeocoderOptions {\r\n  /**\r\n   * Additional URL parameters (strings) that will be added to geocoding requests; can be used to restrict results to a specific country for example, by providing the [`countrycodes`](https://wiki.openstreetmap.org/wiki/Nominatim#Parameters) parameter to Nominatim\r\n   */\r\n  geocodingQueryParams?: Record<string, unknown>;\r\n  /**\r\n   * A function that takes an GeocodingResult as argument and returns an HTML formatted string that represents the result. Default function breaks up address in parts from most to least specific, in attempt to increase readability compared to Nominatim's naming\r\n   */\r\n  htmlTemplate: (r: NominatimResult) => string;\r\n}\r\n\r\n/**\r\n * Implementation of the [Nominatim](https://wiki.openstreetmap.org/wiki/Nominatim) geocoder.\r\n *\r\n * This is the default geocoding service used by the control, unless otherwise specified in the options.\r\n *\r\n * Unless using your own Nominatim installation, please refer to the [Nominatim usage policy](https://operations.osmfoundation.org/policies/nominatim/).\r\n */\r\nexport class Nominatim implements IGeocoder {\r\n  options: NominatimOptions = {\r\n    serviceUrl: 'https://nominatim.openstreetmap.org/',\r\n    htmlTemplate: function(r: NominatimResult) {\r\n      const address = r.address;\r\n      let className: string;\r\n      const parts = [];\r\n      if (address.road || address.building) {\r\n        parts.push('{building} {road} {house_number}');\r\n      }\r\n\r\n      if (address.city || (address as any).town || address.village || address.hamlet) {\r\n        className = parts.length > 0 ? 'leaflet-control-geocoder-address-detail' : '';\r\n        parts.push(\r\n          '<span class=\"' + className + '\">{postcode} {city} {town} {village} {hamlet}</span>'\r\n        );\r\n      }\r\n\r\n      if (address.state || address.country) {\r\n        className = parts.length > 0 ? 'leaflet-control-geocoder-address-context' : '';\r\n        parts.push('<span class=\"' + className + '\">{state} {country}</span>');\r\n      }\r\n\r\n      return template(parts.join('<br/>'), address);\r\n    }\r\n  };\r\n\r\n  constructor(options?: Partial<NominatimOptions>) {\r\n    L.Util.setOptions(this, options || {});\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any) {\r\n    const params = geocodingParams(this.options, {\r\n      q: query,\r\n      limit: 5,\r\n      format: 'json',\r\n      addressdetails: 1\r\n    });\r\n    getJSON(this.options.serviceUrl + 'search', params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      for (let i = data.length - 1; i >= 0; i--) {\r\n        const bbox = data[i].boundingbox;\r\n        for (let j = 0; j < 4; j++) bbox[j] = +bbox[j];\r\n        results[i] = {\r\n          icon: data[i].icon,\r\n          name: data[i].display_name,\r\n          html: this.options.htmlTemplate ? this.options.htmlTemplate(data[i]) : undefined,\r\n          bbox: L.latLngBounds([bbox[0], bbox[2]], [bbox[1], bbox[3]]),\r\n          center: L.latLng(data[i].lat, data[i].lon),\r\n          properties: data[i]\r\n        };\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any) {\r\n    const params = reverseParams(this.options, {\r\n      lat: location.lat,\r\n      lon: location.lng,\r\n      zoom: Math.round(Math.log(scale / 256) / Math.log(2)),\r\n      addressdetails: 1,\r\n      format: 'json'\r\n    });\r\n    getJSON(this.options.serviceUrl + 'reverse', params, data => {\r\n      const result: GeocodingResult[] = [];\r\n      if (data && data.lat && data.lon) {\r\n        const center = L.latLng(data.lat, data.lon);\r\n        const bbox = L.latLngBounds(center, center);\r\n        result.push({\r\n          name: data.display_name,\r\n          html: this.options.htmlTemplate ? this.options.htmlTemplate(data) : undefined,\r\n          center: center,\r\n          bbox: bbox,\r\n          properties: data\r\n        });\r\n      }\r\n      cb.call(context, result);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Nominatim}\r\n * @param options the options\r\n */\r\nexport function nominatim(options?: Partial<NominatimOptions>) {\r\n  return new Nominatim(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { IGeocoder, GeocodingCallback, GeocodingResult } from './api';\r\n\r\nexport interface OpenLocationCodeOptions {\r\n  OpenLocationCode: OpenLocationCodeApi;\r\n  codeLength?: number;\r\n}\r\n\r\nexport interface OpenLocationCodeApi {\r\n  encode(latitude: number, longitude: number, codeLength?: number): string;\r\n  decode(code: string): CodeArea;\r\n}\r\n\r\nexport interface CodeArea {\r\n  latitudeLo: number;\r\n  longitudeLo: number;\r\n  latitudeHi: number;\r\n  longitudeHi: number;\r\n  latitudeCenter: number;\r\n  longitudeCenter: number;\r\n  codeLength: number;\r\n}\r\n\r\n/**\r\n * Implementation of the [Plus codes](https://plus.codes/) (formerly OpenLocationCode) (requires [open-location-code](https://www.npmjs.com/package/open-location-code))\r\n */\r\nexport class OpenLocationCode implements IGeocoder {\r\n  options: OpenLocationCodeOptions;\r\n  constructor(options?: Partial<OpenLocationCodeOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any) {\r\n    try {\r\n      const decoded = this.options.OpenLocationCode.decode(query);\r\n      const result: GeocodingResult = {\r\n        name: query,\r\n        center: L.latLng(decoded.latitudeCenter, decoded.longitudeCenter),\r\n        bbox: L.latLngBounds(\r\n          L.latLng(decoded.latitudeLo, decoded.longitudeLo),\r\n          L.latLng(decoded.latitudeHi, decoded.longitudeHi)\r\n        )\r\n      };\r\n      cb.call(context, [result]);\r\n    } catch (e) {\r\n      console.warn(e); // eslint-disable-line no-console\r\n      cb.call(context, []);\r\n    }\r\n  }\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any) {\r\n    try {\r\n      const code = this.options.OpenLocationCode.encode(\r\n        location.lat,\r\n        location.lng,\r\n        this.options.codeLength\r\n      );\r\n      const result = {\r\n        name: code,\r\n        center: L.latLng(location.lat, location.lng),\r\n        bbox: L.latLngBounds(\r\n          L.latLng(location.lat, location.lng),\r\n          L.latLng(location.lat, location.lng)\r\n        )\r\n      };\r\n      cb.call(context, [result]);\r\n    } catch (e) {\r\n      console.warn(e); // eslint-disable-line no-console\r\n      cb.call(context, []);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link OpenLocationCode}\r\n * @param options the options\r\n */\r\nexport function openLocationCode(options?: Partial<OpenLocationCodeOptions>) {\r\n  return new OpenLocationCode(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface OpenCageOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [OpenCage Data API](https://opencagedata.com/)\r\n */\r\nexport class OpenCage implements IGeocoder {\r\n  options: OpenCageOptions = {\r\n    serviceUrl: 'https://api.opencagedata.com/geocode/v1/json'\r\n  };\r\n\r\n  constructor(options?: Partial<OpenCageOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      key: this.options.apiKey,\r\n      q: query\r\n    });\r\n    getJSON(this.options.serviceUrl, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.results && data.results.length) {\r\n        for (let i = 0; i < data.results.length; i++) {\r\n          const loc = data.results[i];\r\n          const center = L.latLng(loc.geometry);\r\n          let bbox: L.LatLngBounds;\r\n          if (loc.annotations && loc.annotations.bounds) {\r\n            bbox = L.latLngBounds(\r\n              L.latLng(loc.annotations.bounds.northeast),\r\n              L.latLng(loc.annotations.bounds.southwest)\r\n            );\r\n          } else {\r\n            bbox = L.latLngBounds(center, center);\r\n          }\r\n          results.push({\r\n            name: loc.formatted,\r\n            bbox: bbox,\r\n            center: center\r\n          });\r\n        }\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      key: this.options.apiKey,\r\n      q: [location.lat, location.lng].join(',')\r\n    });\r\n    getJSON(this.options.serviceUrl, params, data => {\r\n      const results: GeocodingResult[] = [];\r\n      if (data.results && data.results.length) {\r\n        for (let i = 0; i < data.results.length; i++) {\r\n          const loc = data.results[i];\r\n          const center = L.latLng(loc.geometry);\r\n          let bbox: L.LatLngBounds;\r\n          if (loc.annotations && loc.annotations.bounds) {\r\n            bbox = L.latLngBounds(\r\n              L.latLng(loc.annotations.bounds.northeast),\r\n              L.latLng(loc.annotations.bounds.southwest)\r\n            );\r\n          } else {\r\n            bbox = L.latLngBounds(center, center);\r\n          }\r\n          results.push({\r\n            name: loc.formatted,\r\n            bbox: bbox,\r\n            center: center\r\n          });\r\n        }\r\n      }\r\n      cb.call(context, results);\r\n    });\r\n  }\r\n}\r\n\r\nexport function opencage(options?: Partial<OpenCageOptions>) {\r\n  return new OpenCage(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface PeliasOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the [Pelias](https://pelias.io/), [geocode.earth](https://geocode.earth/) geocoder (formerly Mapzen Search)\r\n */\r\nexport class Pelias implements IGeocoder {\r\n  options: PeliasOptions = {\r\n    serviceUrl: 'https://api.geocode.earth/v1'\r\n  };\r\n\r\n  private _lastSuggest = 0;\r\n\r\n  constructor(options?: Partial<PeliasOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      api_key: this.options.apiKey,\r\n      text: query\r\n    });\r\n    getJSON(this.options.serviceUrl + '/search', params, data => {\r\n      cb.call(context, this._parseResults(data, 'bbox'));\r\n    });\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, {\r\n      api_key: this.options.apiKey,\r\n      text: query\r\n    });\r\n    getJSON(this.options.serviceUrl + '/autocomplete', params, data => {\r\n      if (data.geocoding.timestamp > this._lastSuggest) {\r\n        this._lastSuggest = data.geocoding.timestamp;\r\n        cb.call(context, this._parseResults(data, 'bbox'));\r\n      }\r\n    });\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      api_key: this.options.apiKey,\r\n      'point.lat': location.lat,\r\n      'point.lon': location.lng\r\n    });\r\n    getJSON(this.options.serviceUrl + '/reverse', params, data => {\r\n      cb.call(context, this._parseResults(data, 'bounds'));\r\n    });\r\n  }\r\n\r\n  _parseResults(data, bboxname) {\r\n    const results: GeocodingResult[] = [];\r\n    L.geoJSON(data, {\r\n      pointToLayer: function(feature, latlng) {\r\n        return L.circleMarker(latlng);\r\n      },\r\n      onEachFeature: function(feature, layer: any) {\r\n        const result = {} as GeocodingResult;\r\n        let bbox;\r\n        let center;\r\n\r\n        if (layer.getBounds) {\r\n          bbox = layer.getBounds();\r\n          center = bbox.getCenter();\r\n        } else if (layer.feature.bbox) {\r\n          center = layer.getLatLng();\r\n          bbox = L.latLngBounds(\r\n            L.GeoJSON.coordsToLatLng(layer.feature.bbox.slice(0, 2)),\r\n            L.GeoJSON.coordsToLatLng(layer.feature.bbox.slice(2, 4))\r\n          );\r\n        } else {\r\n          center = layer.getLatLng();\r\n          bbox = L.latLngBounds(center, center);\r\n        }\r\n\r\n        result.name = layer.feature.properties.label;\r\n        result.center = center;\r\n        result[bboxname] = bbox;\r\n        result.properties = layer.feature.properties;\r\n        results.push(result);\r\n      }\r\n    });\r\n    return results;\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Pelias}\r\n * @param options the options\r\n */\r\nexport function pelias(options?: Partial<PeliasOptions>) {\r\n  return new Pelias(options);\r\n}\r\n\r\nexport const GeocodeEarth = Pelias;\r\nexport const geocodeEarth = pelias;\r\n\r\n/**\r\n * r.i.p.\r\n * @deprecated\r\n */\r\nexport const Mapzen = Pelias;\r\n/**\r\n * r.i.p.\r\n * @deprecated\r\n */\r\nexport const mapzen = pelias;\r\n\r\n/**\r\n * Implementation of the [Openrouteservice](https://openrouteservice.org/dev/#/api-docs/geocode) geocoder\r\n */\r\nexport class Openrouteservice extends Pelias {\r\n  constructor(options?: Partial<PeliasOptions>) {\r\n    super(\r\n      L.Util.extend(\r\n        {\r\n          serviceUrl: 'https://api.openrouteservice.org/geocode'\r\n        },\r\n        options\r\n      )\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Openrouteservice}\r\n * @param options the options\r\n */\r\nexport function openrouteservice(options?: Partial<PeliasOptions>) {\r\n  return new Openrouteservice(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface PhotonOptions extends GeocoderOptions {\r\n  reverseUrl: string;\r\n  nameProperties: string[];\r\n  htmlTemplate?: (r: any) => string;\r\n}\r\n\r\n/**\r\n * Implementation of the [Photon](http://photon.komoot.de/) geocoder\r\n */\r\nexport class Photon implements IGeocoder {\r\n  options: PhotonOptions = {\r\n    serviceUrl: 'https://photon.komoot.io/api/',\r\n    reverseUrl: 'https://photon.komoot.io/reverse/',\r\n    nameProperties: ['name', 'street', 'suburb', 'hamlet', 'town', 'city', 'state', 'country']\r\n  };\r\n\r\n  constructor(options?: Partial<PhotonOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    const params = geocodingParams(this.options, { q: query });\r\n    getJSON(\r\n      this.options.serviceUrl,\r\n      params,\r\n      L.Util.bind(function(data) {\r\n        cb.call(context, this._decodeFeatures(data));\r\n      }, this)\r\n    );\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  reverse(latLng: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    const params = reverseParams(this.options, {\r\n      lat: latLng.lat,\r\n      lon: latLng.lng\r\n    });\r\n    getJSON(\r\n      this.options.reverseUrl,\r\n      params,\r\n      L.Util.bind(function(data) {\r\n        cb.call(context, this._decodeFeatures(data));\r\n      }, this)\r\n    );\r\n  }\r\n\r\n  _decodeFeatures(data: GeoJSON.FeatureCollection<GeoJSON.Point>) {\r\n    const results: GeocodingResult[] = [];\r\n\r\n    if (data && data.features) {\r\n      for (let i = 0; i < data.features.length; i++) {\r\n        const f = data.features[i];\r\n        const c = f.geometry.coordinates;\r\n        const center = L.latLng(c[1], c[0]);\r\n        const extent = f.properties.extent;\r\n\r\n        const bbox = extent\r\n          ? L.latLngBounds([extent[1], extent[0]], [extent[3], extent[2]])\r\n          : L.latLngBounds(center, center);\r\n\r\n        results.push({\r\n          name: this._decodeFeatureName(f),\r\n          html: this.options.htmlTemplate ? this.options.htmlTemplate(f) : undefined,\r\n          center: center,\r\n          bbox: bbox,\r\n          properties: f.properties\r\n        });\r\n      }\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  _decodeFeatureName(f: GeoJSON.Feature) {\r\n    return (this.options.nameProperties || [])\r\n      .map(p => {\r\n        return f.properties[p];\r\n      })\r\n      .filter(v => {\r\n        return !!v;\r\n      })\r\n      .join(', ');\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link Photon}\r\n * @param options the options\r\n */\r\nexport function photon(options?: Partial<PhotonOptions>) {\r\n  return new Photon(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { getJSON } from '../util';\r\nimport {\r\n  IGeocoder,\r\n  GeocoderOptions,\r\n  GeocodingCallback,\r\n  geocodingParams,\r\n  GeocodingResult,\r\n  reverseParams\r\n} from './api';\r\n\r\nexport interface What3WordsOptions extends GeocoderOptions {}\r\n\r\n/**\r\n * Implementation of the What3Words service\r\n */\r\nexport class What3Words implements IGeocoder {\r\n  options: What3WordsOptions = {\r\n    serviceUrl: 'https://api.what3words.com/v2/'\r\n  };\r\n\r\n  constructor(options: Partial<What3WordsOptions>) {\r\n    L.Util.setOptions(this, options);\r\n  }\r\n\r\n  geocode(query: string, cb: GeocodingCallback, context?: any): void {\r\n    //get three words and make a dot based string\r\n    getJSON(\r\n      this.options.serviceUrl + 'forward',\r\n      geocodingParams(this.options, {\r\n        key: this.options.apiKey,\r\n        addr: query.split(/\\s+/).join('.')\r\n      }),\r\n      data => {\r\n        const results: GeocodingResult[] = [];\r\n        if (data.geometry) {\r\n          const latLng = L.latLng(data.geometry['lat'], data.geometry['lng']);\r\n          const latLngBounds = L.latLngBounds(latLng, latLng);\r\n          results[0] = {\r\n            name: data.words,\r\n            bbox: latLngBounds,\r\n            center: latLng\r\n          };\r\n        }\r\n\r\n        cb.call(context, results);\r\n      }\r\n    );\r\n  }\r\n\r\n  suggest(query: string, cb: GeocodingCallback, context?: any): void {\r\n    return this.geocode(query, cb, context);\r\n  }\r\n\r\n  reverse(location: L.LatLngLiteral, scale: number, cb: GeocodingCallback, context?: any): void {\r\n    getJSON(\r\n      this.options.serviceUrl + 'reverse',\r\n      reverseParams(this.options, {\r\n        key: this.options.apiKey,\r\n        coords: [location.lat, location.lng].join(',')\r\n      }),\r\n      data => {\r\n        const results: GeocodingResult[] = [];\r\n        if (data.status.status == 200) {\r\n          const center = L.latLng(data.geometry['lat'], data.geometry['lng']);\r\n          const bbox = L.latLngBounds(center, center);\r\n          results[0] = {\r\n            name: data.words,\r\n            bbox: bbox,\r\n            center: center\r\n          };\r\n        }\r\n        cb.call(context, results);\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link What3Words}\r\n * @param options the options\r\n */\r\nexport function what3words(options: Partial<What3WordsOptions>) {\r\n  return new What3Words(options);\r\n}\r\n","import * as L from 'leaflet';\r\nimport { Nominatim } from './geocoders/index';\r\nimport { IGeocoder, GeocodingResult } from './geocoders/api';\r\n\r\nexport interface GeocoderControlOptions extends L.ControlOptions {\r\n  /**\r\n   * Collapse control unless hovered/clicked\r\n   */\r\n  collapsed: boolean;\r\n  /**\r\n   * How to expand a collapsed control: `touch` or `click` or `hover`\r\n   */\r\n  expand: 'touch' | 'click' | 'hover';\r\n  /**\r\n   * Placeholder text for text input\r\n   */\r\n  placeholder: string;\r\n  /**\r\n   * Message when no result found / geocoding error occurs\r\n   */\r\n  errorMessage: string;\r\n  /**\r\n   * Accessibility label for the search icon used by screen readers\r\n   */\r\n  iconLabel: string;\r\n  /**\r\n   * Object to perform the actual geocoding queries\r\n   */\r\n  geocoder?: IGeocoder;\r\n  /**\r\n   * Immediately show the unique result without prompting for alternatives\r\n   */\r\n  showUniqueResult: boolean;\r\n  /**\r\n   * Show icons for geocoding results (if available); supported by Nominatim\r\n   */\r\n  showResultIcons: boolean;\r\n  /**\r\n   * Minimum number characters before suggest functionality is used (if available from geocoder)\r\n   */\r\n  suggestMinLength: number;\r\n  /**\r\n   * Number of milliseconds after typing stopped before suggest functionality is used (if available from geocoder)\r\n   */\r\n  suggestTimeout: number;\r\n  /**\r\n   * Initial query string for text input\r\n   */\r\n  query: string;\r\n  /**\r\n   * Minimum number of characters in search text before performing a query\r\n   */\r\n  queryMinLength: number;\r\n  /**\r\n   * Whether to mark a geocoding result on the map by default\r\n   */\r\n  defaultMarkGeocode: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Leaflet mixins https://leafletjs.com/reference-1.7.1.html#class-includes\r\n * for TypeScript https://www.typescriptlang.org/docs/handbook/mixins.html\r\n * @internal\r\n */\r\nclass EventedControl {\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  constructor(...args: any[]) {\r\n    // empty\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\ninterface EventedControl extends L.Control, L.Evented {}\r\nL.Util.extend(EventedControl.prototype, L.Control.prototype);\r\nL.Util.extend(EventedControl.prototype, L.Evented.prototype);\r\n\r\n/**\r\n * This is the geocoder control. It works like any other [Leaflet control](https://leafletjs.com/reference.html#control), and is added to the map.\r\n */\r\nexport class GeocoderControl extends EventedControl {\r\n  options: GeocoderControlOptions = {\r\n    showUniqueResult: true,\r\n    showResultIcons: false,\r\n    collapsed: true,\r\n    expand: 'touch',\r\n    position: 'topright',\r\n    placeholder: 'Search...',\r\n    errorMessage: 'Nothing found.',\r\n    iconLabel: 'Initiate a new search',\r\n    query: '',\r\n    queryMinLength: 1,\r\n    suggestMinLength: 3,\r\n    suggestTimeout: 250,\r\n    defaultMarkGeocode: true\r\n  };\r\n\r\n  private _alts: HTMLUListElement;\r\n  private _container: HTMLDivElement;\r\n  private _errorElement: HTMLDivElement;\r\n  private _form: HTMLDivElement;\r\n  private _geocodeMarker: L.Marker;\r\n  private _input: HTMLInputElement;\r\n  private _lastGeocode: string;\r\n  private _map: L.Map;\r\n  private _preventBlurCollapse: boolean;\r\n  private _requestCount = 0;\r\n  private _results: any;\r\n  private _selection: any;\r\n  private _suggestTimeout: any;\r\n\r\n  /**\r\n   * Instantiates a geocoder control (to be invoked using `new`)\r\n   * @param options the options\r\n   */\r\n  constructor(options?: Partial<GeocoderControlOptions>) {\r\n    super(options);\r\n    L.Util.setOptions(this, options);\r\n    if (!this.options.geocoder) {\r\n      this.options.geocoder = new Nominatim();\r\n    }\r\n  }\r\n\r\n  addThrobberClass() {\r\n    L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-throbber');\r\n  }\r\n\r\n  removeThrobberClass() {\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-throbber');\r\n  }\r\n\r\n  /**\r\n   * Returns the container DOM element for the control and add listeners on relevant map events.\r\n   * @param map the map instance\r\n   * @see https://leafletjs.com/reference.html#control-onadd\r\n   */\r\n  onAdd(map: L.Map) {\r\n    const className = 'leaflet-control-geocoder';\r\n    const container = L.DomUtil.create('div', className + ' leaflet-bar') as HTMLDivElement;\r\n    const icon = L.DomUtil.create('button', className + '-icon', container) as HTMLButtonElement;\r\n    const form = (this._form = L.DomUtil.create(\r\n      'div',\r\n      className + '-form',\r\n      container\r\n    ) as HTMLDivElement);\r\n\r\n    this._map = map;\r\n    this._container = container;\r\n\r\n    icon.innerHTML = '&nbsp;';\r\n    icon.type = 'button';\r\n    icon.setAttribute('aria-label', this.options.iconLabel);\r\n\r\n    const input = (this._input = L.DomUtil.create('input', '', form) as HTMLInputElement);\r\n    input.type = 'text';\r\n    input.value = this.options.query;\r\n    input.placeholder = this.options.placeholder;\r\n    L.DomEvent.disableClickPropagation(input);\r\n\r\n    this._errorElement = L.DomUtil.create(\r\n      'div',\r\n      className + '-form-no-error',\r\n      container\r\n    ) as HTMLDivElement;\r\n    this._errorElement.innerHTML = this.options.errorMessage;\r\n\r\n    this._alts = L.DomUtil.create(\r\n      'ul',\r\n      className + '-alternatives leaflet-control-geocoder-alternatives-minimized',\r\n      container\r\n    ) as HTMLUListElement;\r\n    L.DomEvent.disableClickPropagation(this._alts);\r\n\r\n    L.DomEvent.addListener(input, 'keydown', this._keydown, this);\r\n    if (this.options.geocoder.suggest) {\r\n      L.DomEvent.addListener(input, 'input', this._change, this);\r\n    }\r\n    L.DomEvent.addListener(input, 'blur', () => {\r\n      if (this.options.collapsed && !this._preventBlurCollapse) {\r\n        this._collapse();\r\n      }\r\n      this._preventBlurCollapse = false;\r\n    });\r\n\r\n    if (this.options.collapsed) {\r\n      if (this.options.expand === 'click') {\r\n        L.DomEvent.addListener(container, 'click', (e: Event) => {\r\n          if ((e as MouseEvent).button === 0 && (e as MouseEvent).detail !== 2) {\r\n            this._toggle();\r\n          }\r\n        });\r\n      } else if (this.options.expand === 'touch') {\r\n        L.DomEvent.addListener(\r\n          container,\r\n          L.Browser.touch ? 'touchstart mousedown' : 'mousedown',\r\n          (e: Event) => {\r\n            this._toggle();\r\n            e.preventDefault(); // mobile: clicking focuses the icon, so UI expands and immediately collapses\r\n            e.stopPropagation();\r\n          },\r\n          this\r\n        );\r\n      } else {\r\n        L.DomEvent.addListener(container, 'mouseover', this._expand, this);\r\n        L.DomEvent.addListener(container, 'mouseout', this._collapse, this);\r\n        this._map.on('movestart', this._collapse, this);\r\n      }\r\n    } else {\r\n      this._expand();\r\n      if (L.Browser.touch) {\r\n        L.DomEvent.addListener(container, 'touchstart', () => this._geocode());\r\n      } else {\r\n        L.DomEvent.addListener(container, 'click', () => this._geocode());\r\n      }\r\n    }\r\n\r\n    if (this.options.defaultMarkGeocode) {\r\n      this.on('markgeocode', this.markGeocode as any, this);\r\n    }\r\n\r\n    this.on('startgeocode', this.addThrobberClass, this);\r\n    this.on('finishgeocode', this.removeThrobberClass, this);\r\n    this.on('startsuggest', this.addThrobberClass, this);\r\n    this.on('finishsuggest', this.removeThrobberClass, this);\r\n\r\n    L.DomEvent.disableClickPropagation(container);\r\n\r\n    return container;\r\n  }\r\n\r\n  /**\r\n   * Sets the query string on the text input\r\n   * @param string the query string\r\n   */\r\n  setQuery(string: string): this {\r\n    this._input.value = string;\r\n    return this;\r\n  }\r\n\r\n  private _geocodeResult(results: GeocodingResult[], suggest: boolean) {\r\n    if (!suggest && this.options.showUniqueResult && results.length === 1) {\r\n      this._geocodeResultSelected(results[0]);\r\n    } else if (results.length > 0) {\r\n      this._alts.innerHTML = '';\r\n      this._results = results;\r\n      L.DomUtil.removeClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n      L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-options-open');\r\n      for (let i = 0; i < results.length; i++) {\r\n        this._alts.appendChild(this._createAlt(results[i], i));\r\n      }\r\n    } else {\r\n      L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-options-error');\r\n      L.DomUtil.addClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Marks a geocoding result on the map\r\n   * @param result the geocoding result\r\n   */\r\n  markGeocode(result: GeocodingResult) {\r\n    result = (result as any).geocode || result;\r\n\r\n    this._map.fitBounds(result.bbox);\r\n\r\n    if (this._geocodeMarker) {\r\n      this._map.removeLayer(this._geocodeMarker);\r\n    }\r\n\r\n    this._geocodeMarker = new L.Marker(result.center)\r\n      .bindPopup(result.html || result.name)\r\n      .addTo(this._map)\r\n      .openPopup();\r\n\r\n    return this;\r\n  }\r\n\r\n  private _geocode(suggest?: boolean) {\r\n    const value = this._input.value;\r\n    if (!suggest && value.length < this.options.queryMinLength) {\r\n      return;\r\n    }\r\n\r\n    const requestCount = ++this._requestCount;\r\n    const cb = (results: GeocodingResult[]) => {\r\n      if (requestCount === this._requestCount) {\r\n        this.fire(suggest ? 'finishsuggest' : 'finishgeocode', { input: value, results });\r\n        this._geocodeResult(results, suggest);\r\n      }\r\n    };\r\n\r\n    this._lastGeocode = value;\r\n    if (!suggest) {\r\n      this._clearResults();\r\n    }\r\n\r\n    this.fire(suggest ? 'startsuggest' : 'startgeocode', { input: value });\r\n    if (suggest) {\r\n      this.options.geocoder.suggest(value, cb);\r\n    } else {\r\n      this.options.geocoder.geocode(value, cb);\r\n    }\r\n  }\r\n\r\n  private _geocodeResultSelected(result: GeocodingResult) {\r\n    this.fire('markgeocode', { geocode: result });\r\n  }\r\n\r\n  private _toggle() {\r\n    if (L.DomUtil.hasClass(this._container, 'leaflet-control-geocoder-expanded')) {\r\n      this._collapse();\r\n    } else {\r\n      this._expand();\r\n    }\r\n  }\r\n\r\n  private _expand() {\r\n    L.DomUtil.addClass(this._container, 'leaflet-control-geocoder-expanded');\r\n    this._input.select();\r\n    this.fire('expand');\r\n  }\r\n\r\n  private _collapse() {\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-expanded');\r\n    L.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n    L.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-options-open');\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-options-error');\r\n    this._input.blur(); // mobile: keyboard shouldn't stay expanded\r\n    this.fire('collapse');\r\n  }\r\n\r\n  private _clearResults() {\r\n    L.DomUtil.addClass(this._alts, 'leaflet-control-geocoder-alternatives-minimized');\r\n    this._selection = null;\r\n    L.DomUtil.removeClass(this._errorElement, 'leaflet-control-geocoder-error');\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-options-open');\r\n    L.DomUtil.removeClass(this._container, 'leaflet-control-geocoder-options-error');\r\n  }\r\n\r\n  private _createAlt(result: GeocodingResult, index: number) {\r\n    const li = L.DomUtil.create('li', ''),\r\n      a = L.DomUtil.create('a', '', li),\r\n      icon =\r\n        this.options.showResultIcons && result.icon\r\n          ? (L.DomUtil.create('img', '', a) as HTMLImageElement)\r\n          : null,\r\n      text = result.html ? undefined : document.createTextNode(result.name),\r\n      mouseDownHandler = (e: Event) => {\r\n        // In some browsers, a click will fire on the map if the control is\r\n        // collapsed directly after mousedown. To work around this, we\r\n        // wait until the click is completed, and _then_ collapse the\r\n        // control. Messy, but this is the workaround I could come up with\r\n        // for #142.\r\n        this._preventBlurCollapse = true;\r\n        L.DomEvent.stop(e);\r\n        this._geocodeResultSelected(result);\r\n        L.DomEvent.on(li, 'click touchend', () => {\r\n          if (this.options.collapsed) {\r\n            this._collapse();\r\n          } else {\r\n            this._clearResults();\r\n          }\r\n        });\r\n      };\r\n\r\n    if (icon) {\r\n      icon.src = result.icon;\r\n    }\r\n\r\n    li.setAttribute('data-result-index', String(index));\r\n\r\n    if (result.html) {\r\n      a.innerHTML = a.innerHTML + result.html;\r\n    } else if (text) {\r\n      a.appendChild(text);\r\n    }\r\n\r\n    // Use mousedown and not click, since click will fire _after_ blur,\r\n    // causing the control to have collapsed and removed the items\r\n    // before the click can fire.\r\n    L.DomEvent.addListener(li, 'mousedown touchstart', mouseDownHandler, this);\r\n\r\n    return li;\r\n  }\r\n\r\n  private _keydown(e: KeyboardEvent) {\r\n    const select = (dir: number) => {\r\n      if (this._selection) {\r\n        L.DomUtil.removeClass(this._selection, 'leaflet-control-geocoder-selected');\r\n        this._selection = this._selection[dir > 0 ? 'nextSibling' : 'previousSibling'];\r\n      }\r\n      if (!this._selection) {\r\n        this._selection = this._alts[dir > 0 ? 'firstChild' : 'lastChild'];\r\n      }\r\n\r\n      if (this._selection) {\r\n        L.DomUtil.addClass(this._selection, 'leaflet-control-geocoder-selected');\r\n      }\r\n    };\r\n\r\n    switch (e.keyCode) {\r\n      // Escape\r\n      case 27:\r\n        if (this.options.collapsed) {\r\n          this._collapse();\r\n        } else {\r\n          this._clearResults();\r\n        }\r\n        break;\r\n      // Up\r\n      case 38:\r\n        select(-1);\r\n        break;\r\n      // Up\r\n      case 40:\r\n        select(1);\r\n        break;\r\n      // Enter\r\n      case 13:\r\n        if (this._selection) {\r\n          const index = parseInt(this._selection.getAttribute('data-result-index'), 10);\r\n          this._geocodeResultSelected(this._results[index]);\r\n          this._clearResults();\r\n        } else {\r\n          this._geocode();\r\n        }\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    L.DomEvent.preventDefault(e);\r\n  }\r\n\r\n  private _change() {\r\n    const v = this._input.value;\r\n    if (v !== this._lastGeocode) {\r\n      clearTimeout(this._suggestTimeout);\r\n      if (v.length >= this.options.suggestMinLength) {\r\n        this._suggestTimeout = setTimeout(() => this._geocode(true), this.options.suggestTimeout);\r\n      } else {\r\n        this._clearResults();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * [Class factory method](https://leafletjs.com/reference.html#class-class-factories) for {@link GeocoderControl}\r\n * @param options the options\r\n */\r\nexport function geocoder(options?: Partial<GeocoderControlOptions>) {\r\n  return new GeocoderControl(options);\r\n}\r\n","/* @preserve\r\n * Leaflet Control Geocoder\r\n * https://github.com/perliedman/leaflet-control-geocoder\r\n *\r\n * Copyright (c) 2012 sa3m (https://github.com/sa3m)\r\n * Copyright (c) 2018 Per Liedman\r\n * All rights reserved.\r\n */\r\nimport * as L from 'leaflet';\r\nimport { GeocoderControl as Geocoder, geocoder } from './control';\r\nimport * as geocoders from './geocoders/index';\r\n\r\nL.Util.extend(Geocoder, geocoders);\r\nexport default Geocoder;\r\n\r\nL.Util.extend(L.Control, {\r\n  Geocoder: Geocoder,\r\n  geocoder: geocoder\r\n});\r\n"],"names":["geocodingParams","options","params","L","extend","geocodingQueryParams","reverseParams","reverseQueryParams","lastCallbackId","badChars","possible","escape","escapeChar","chr","htmlEscape","string","test","replace","jsonp","url","callback","context","jsonpParam","callbackId","window","bind","script","document","createElement","type","src","getParamString","id","getElementsByTagName","appendChild","getJSON","xmlHttp","XMLHttpRequest","onreadystatechange","readyState","message","status","response","JSON","parse","e","open","responseType","setRequestHeader","send","template","str","data","key","value","undefined","obj","existingUrl","uppercase","i","encodeURIComponent","toUpperCase","Array","isArray","push","String","j","length","indexOf","join","ArcGis","serviceUrl","apiKey","setOptions","geocode","query","cb","token","SingleLine","outFields","forStorage","maxLocations","f","results","candidates","loc","latLng","location","y","x","latLngBounds","extent","ymax","xmax","ymin","xmin","name","address","bbox","center","call","suggest","reverse","scale","lng","lat","distance","result","error","Match_addr","arcgis","Bing","resourceSets","resources","resource","point","coordinates","bing","Google","geometry","viewport","northeast","southwest","formatted_address","properties","address_components","latlng","google","HERE","app_id","app_code","Error","searchtext","gen","jsonattributes","prox","reverseGeocodeProxRadius","mode","view","displayPosition","latitude","longitude","mapView","topLeft","bottomRight","label","HEREv2","q","at","limit","items","item","position","south","west","north","east","here","parseLatLng","match","LatLng","next","sizeInMeters","toBounds","Mapbox","_getProperties","text","split","short_code","access_token","proximity","features","slice","place_name","param","mapbox","MapQuest","decodeURIComponent","_formatName","filter","s","outFormat","locations","street","adminArea4","adminArea3","adminArea1","outputFormat","mapQuest","Neutrino","userId","found","neutrino","Nominatim","htmlTemplate","r","className","parts","road","building","city","town","village","hamlet","state","country","format","addressdetails","boundingbox","icon","display_name","html","lon","zoom","Math","round","log","nominatim","OpenLocationCode","decoded","decode","latitudeCenter","longitudeCenter","latitudeLo","longitudeLo","latitudeHi","longitudeHi","console","warn","code","encode","codeLength","openLocationCode","OpenCage","annotations","bounds","formatted","opencage","Pelias","api_key","_parseResults","geocoding","timestamp","_lastSuggest","bboxname","pointToLayer","feature","onEachFeature","layer","getBounds","getCenter","getLatLng","coordsToLatLng","pelias","GeocodeEarth","geocodeEarth","Mapzen","mapzen","Openrouteservice","openrouteservice","Photon","reverseUrl","nameProperties","_decodeFeatures","c","_decodeFeatureName","map","p","v","photon","What3Words","addr","words","coords","what3words","EventedControl","prototype","GeocoderControl","showUniqueResult","showResultIcons","collapsed","expand","placeholder","errorMessage","iconLabel","queryMinLength","suggestMinLength","suggestTimeout","defaultMarkGeocode","geocoder","addThrobberClass","addClass","_container","removeThrobberClass","removeClass","onAdd","container","create","form","_form","_map","innerHTML","setAttribute","input","_input","disableClickPropagation","_errorElement","_alts","addListener","_keydown","_change","_preventBlurCollapse","_collapse","button","detail","_toggle","touch","preventDefault","stopPropagation","_expand","on","_geocode","markGeocode","setQuery","_geocodeResult","_geocodeResultSelected","_results","_createAlt","fitBounds","_geocodeMarker","removeLayer","bindPopup","addTo","openPopup","requestCount","_requestCount","fire","_lastGeocode","_clearResults","hasClass","select","blur","_selection","index","li","a","createTextNode","mouseDownHandler","stop","dir","keyCode","parseInt","getAttribute","clearTimeout","_suggestTimeout","setTimeout","Geocoder","geocoders"],"mappings":"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"}